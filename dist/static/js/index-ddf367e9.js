import{d as q,O as de,j as M,U as me,Q as i,R as m,u as _,F as h,X as $,S as b,c as x,V as pe,Y as E,Z as T,_ as fe,$ as _e,a0 as ye,a1 as H,r as y,k as we,o as ge,a2 as w,a3 as P,a4 as he,a5 as ve,a6 as xe}from"./@vue-6bcad18c.js";import{a as be,b as ke,C as Ce,I as Te}from"./ant-design-vue-bce79523.js";import{d as B}from"./pinia-8eb1303e.js";import{_ as Re,l as Se}from"./lodash-d7b3dfde.js";import{d as A,D as Ee}from"./dayjs-d3e5c816.js";import{_ as j}from"./index-b2c88374.js";import{a as $e}from"./axios-9cbf0d09.js";import{_ as Oe}from"./plugin-vueexport-helper-c27b6911.js";import{g as Ie}from"./getopts-220bc5b6.js";const Le=/(((https?:(?:\/\/)?)(?:[-;:&=\+\$,\w]+@)?[A-Za-z0-9.-]+(?::\d+)?|(?:www.|[-;:&=\+\$,\w]+@)[A-Za-z0-9.-]+)((?:\/[\+~%\/.\w-_]*)?\??(?:[-\+=&;%@.\w_]*)#?(?:[\w]*))?)/,Pe=e=>{if(!e)return e;const t=new RegExp(Le,"gi");return e.replaceAll(t,"<a href='$1' target='_blank'>$1</a>")},He={class:"content-output"},je=["innerHTML"],qe=q({__name:"ContentOutput",props:{output:{}},setup(e){const t=e,{output:s}=de(t),o=M(()=>{if(!s.value.status)return"";switch(s.value.status){case"info":return"dodgerblue";case"success":return"limegreen";case"warning":return"darkorange";case"error":return"#c0300f";case"system":return"#bfc4c9";default:return""}});return(r,n)=>{const a=me("CheckCircleOutlined"),u=be;return i(),m("div",He,[_(s).type==="text"?(i(),m(h,{key:0},[o.value?(i(),$(u,{key:0,color:o.value},{icon:b(()=>[x(a)]),default:b(()=>[pe(" "+E(_(s).status),1)]),_:1},8,["color"])):T("",!0),_(s).type==="text"?(i(),m("span",{key:1,innerHTML:_(Pe)(_(s).text)},null,8,je)):T("",!0)],64)):T("",!0),_(s).type==="component"?(i(),$(ye(_(s).component),fe(_e({key:1},_(s).props??{})),null,16)):T("",!0)])}}});const D=B("terminalConfig",{state:()=>({background:"black",showHint:!0,welcomeTexts:[]}),getters:{},actions:{setWelcomeTexts(e){this.welcomeTexts=e}},persist:{key:"terminal-config-store",storage:window.localStorage,beforeRestore:()=>{console.log("load terminalConfigStore data start")},afterRestore:()=>{console.log("load terminalConfigStore data end")}}});A.locale("zh-cn");A.extend(Ee);const Ae={func:"date",name:"日期",options:[],collapsible:!1,action(e,t){const o=`当前时间：${A().format("YYYY-MM-DD HH:mm:ss")}`;t.writeTextSuccessResult(o)}},De={func:"welcome",name:"自定义终端欢迎语",alias:[],params:[{key:"texts",desc:"终端提示文本（支持多个值，不填则无欢迎语）",required:!1}],options:[],action(e,t){const{_:s}=e,{setWelcomeTexts:o}=D();o(s)}},Ne={func:"baidu",name:"百度",params:[{key:"word",desc:"搜索内容",required:!0}],options:[{key:"self",desc:"是否当前页面打开",alias:["s"],type:"boolean",defaultValue:!1},{key:"picture",desc:"是否搜索图片",alias:["p"],type:"boolean",defaultValue:!1}],alias:[],collapsible:!1,action(e,t){const{_:s,self:o,picture:r}=e,n=s.length>0?s[0]:"";let a=`https://www.baidu.com/s?wd=${n}`;r&&(a=`https://image.baidu.com/search/index?tn=baiduimage&word=${n}`),o?window.location.href=a:window.open(a)}},W={func:"help",name:"查看帮助",desc:"help 查看系统集成的命令",alias:[],params:[{key:"commandName",desc:"命令英文名称"}],options:[],collapsible:!0,action(e,t,s){const{_:o}=e;if(o.length<1){const d={type:"component",component:H(()=>j(()=>import("./HelpBox-279a6983.js"),["./HelpBox-279a6983.js","./ant-design-vue-bce79523.js","./@babel-2553f0e6.js","./@vue-6bcad18c.js","./lodash-es-80ba6ea5.js","./dom-align-ecb06dd6.js","./resize-observer-polyfill-0f9f8adb.js","./@ant-design-559a3a45.js","./@ctrl-fb5a5473.js","./dayjs-d3e5c816.js","./aplayer-fd5141c9.js","..\\css\\aplayer-2531d34a.css","./vue-types-ef06c517.js","./@emotion-f7664732.js","./stylis-5efc5547.js","./pinia-8eb1303e.js","./vue-demi-71ba0ef2.js","./lodash-d7b3dfde.js","./index-b2c88374.js","./vue-router-6383198c.js","./pinia-plugin-persistedstate-ed167f96.js","..\\css\\index-1ff51367.css","./axios-9cbf0d09.js","./plugin-vueexport-helper-c27b6911.js","./getopts-220bc5b6.js"],import.meta.url))};t.writeResult(d);return}console.log(o);const r=o[0];let n=k;s&&s.subCommands&&Object.keys(s.subCommands).length>0&&(n=s.subCommands);const a=n[r];if(!a){t.writeTextErrorResult("找不到命令");return}const u={type:"component",component:H(()=>j(()=>import("./CommandHelpBox-b495d3cf.js"),["./CommandHelpBox-b495d3cf.js","./@vue-6bcad18c.js","./ant-design-vue-bce79523.js","./@babel-2553f0e6.js","./lodash-es-80ba6ea5.js","./dom-align-ecb06dd6.js","./resize-observer-polyfill-0f9f8adb.js","./@ant-design-559a3a45.js","./@ctrl-fb5a5473.js","./dayjs-d3e5c816.js","./aplayer-fd5141c9.js","..\\css\\aplayer-2531d34a.css","./vue-types-ef06c517.js","./@emotion-f7664732.js","./stylis-5efc5547.js","./pinia-8eb1303e.js","./vue-demi-71ba0ef2.js","./lodash-d7b3dfde.js","./index-b2c88374.js","./vue-router-6383198c.js","./pinia-plugin-persistedstate-ed167f96.js","..\\css\\index-1ff51367.css","./axios-9cbf0d09.js","./plugin-vueexport-helper-c27b6911.js","./getopts-220bc5b6.js"],import.meta.url)),props:{command:a,parentCommand:s}};t.writeResult(u)}},Y={username:"local"},v=$e.create({baseURL:"http://goaction.top/api"});v.defaults.withCredentials=!0;v.interceptors.request.use(function(e){return e},function(e){return Promise.reject(e)});v.interceptors.response.use(function(e){return e.data},function(e){return Promise.reject(e)});const Ue=async(e,t,s)=>!e||!t||!s?null:await v.post("/user/register",{username:e,password:t,email:s}),Ve=async(e,t)=>!e||!t?null:await v.post("/user/login",{username:e,password:t}),Ke=async()=>await v.post("/user/info"),F=B("user",{state:()=>({userInfo:{...Y}}),getters:{},persist:{key:"user-store",storage:window.localStorage,beforeRestore:e=>{console.log("load userStore data start")},afterRestore:e=>{console.log("load userStore data end")}},actions:{async getAndSetUserInfo(){const e=await Ke();e.code===200&&e.data?this.userInfo=e.data:(console.error("登录失败"),this.$reset())},setUserInfo(e){this.userInfo=e}}}),ze={func:"register",name:"用户注册",options:[{key:"username",desc:"用户名",alias:["u"],type:"string",required:!0},{key:"password",desc:"密码",alias:["p"],type:"string",required:!0},{key:"email",desc:"邮箱",alias:["e"],type:"string",required:!0}],async action(e,t){const{username:s,password:o,email:r}=e;if(!s){t.writeTextErrorResult("请输入用户名");return}if(!o){t.writeTextErrorResult("请输入密码");return}if(!r){t.writeTextErrorResult("请输入邮箱");return}const n=await Ue(s,o,r);(n==null?void 0:n.code)===200?t.writeTextSuccessResult("注册成功"):t.writeTextErrorResult((n==null?void 0:n.message)??"注册失败")}},Me={func:"login",name:"用户登录",options:[{key:"username",alias:["u"],type:"string",required:!0},{key:"password",alias:["p"],type:"string",required:!0}],async action(e,t){const{username:s,password:o}=e;if(!s){t.writeTextErrorResult("请输入用户名");return}if(!o){t.writeTextErrorResult("请输入密码");return}const r=await Ve(s,o),{setUserInfo:n}=F();r.code===200?(n(r.data),t.writeTextSuccessResult("登录成功")):t.writeTextErrorResult(r.message??"登录失败")}},Be={func:"user",name:"用户",alias:[],params:[{key:"subCommand",desc:"子命令",required:!0}],options:[],subCommands:{register:ze,login:Me},action(e,t){const{userInfo:s}=F();if(s&&s.username!==Y.username){let o=`当前用户：${s.username}`;s.email&&(o+=` ${s.email}`),t.writeTextResult(o)}else t.writeTextErrorResult("未登录，请使用命令 user login 进行登录")}},We=[Be],Ye=async(e,t)=>e?await v.post("/fanyi/translate",{keywords:e,config:t}):null,Fe={func:"fanyi",name:"翻译",alias:[],params:[{key:"word",desc:"要翻译的内容",required:!0}],options:[{key:"from",desc:"源语言",alias:["f"],type:"string",defaultValue:"auto"},{key:"to",desc:"目标语言",alias:["t"],type:"string",defaultValue:"auto"}],async action(e,t){const{_:s,from:o,to:r}=e;if(s.length<1){t.writeTextErrorResult("参数不足");return}const n=s.join(" "),a=await Ye(n,{from:o,to:r});(a==null?void 0:a.code)===200?t.writeTextSuccessResult(`翻译结果：${a.data.trans_result[0].dst}`):t.writeTextErrorResult((a==null?void 0:a.message)??"翻译失败")}},Ze={func:"clear",name:"清屏",alias:[],options:[],action(e,t){setTimeout(()=>{t.clear()})}},Ge={func:"history",name:"历史命令",alias:["his"],options:[],action(e,t){t.listCommandHistory().forEach((o,r)=>{t.writeTextResult(`${r+1}、 ${o.text}`)})}},Qe={func:"music",name:"音乐",desc:"在线听音乐",alias:[],params:[{key:"name",desc:"音乐名称",required:!0}],options:[],collapsible:!0,action(e,t){const{_:s}=e;if(s.length<1){t.writeTextErrorResult("参数不足");return}const o=s[0],r={type:"component",component:H(()=>j(()=>import("./MusicBox-188e29b9.js"),["./MusicBox-188e29b9.js","./aplayer-fd5141c9.js","..\\css\\aplayer-2531d34a.css","./@vue-6bcad18c.js","./ant-design-vue-bce79523.js","./@babel-2553f0e6.js","./lodash-es-80ba6ea5.js","./dom-align-ecb06dd6.js","./resize-observer-polyfill-0f9f8adb.js","./@ant-design-559a3a45.js","./@ctrl-fb5a5473.js","./dayjs-d3e5c816.js","./vue-types-ef06c517.js","./@emotion-f7664732.js","./stylis-5efc5547.js","./pinia-8eb1303e.js","./vue-demi-71ba0ef2.js","./lodash-d7b3dfde.js","./index-b2c88374.js","./vue-router-6383198c.js","./pinia-plugin-persistedstate-ed167f96.js","..\\css\\index-1ff51367.css","./axios-9cbf0d09.js","./plugin-vueexport-helper-c27b6911.js","./getopts-220bc5b6.js","..\\css\\MusicBox-c064cd8e.css"],import.meta.url)),props:{name:o}};t.writeResult(r)}},Xe=[W,De,Ae,Ne,...We,Fe,Ze,Ge,Qe],k={};Xe.forEach(e=>{var t;k[e.func]=e,(t=e.alias)==null||t.forEach(s=>{k[s]=e})});const z=(e,t)=>{var o;if(!e)return"";let s="";if(t&&(s=t.func+" "),s+=e.func,e.params&&e.params.length>0){const r=e.params.map(n=>{let a=n.key;return n.desc&&(a=n.desc),n.required?`<${a}>`:`[${a}]`});s+=" "+r.join(" ")}if(((o=e.options)==null?void 0:o.length)>0){const r=e.options.map(n=>{const a=Je(n);if(n.type==="boolean"){let u=a;return n.desc&&(u+=` ${n.desc}`),n.required?`<${u}>`:`[${u}]`}else{let u=n.key;return n.desc&&(u=n.desc),n.required?`<${a} ${u}>`:`[${a} ${u}]`}});s+=" "+r.join(" ")}return s},Je=e=>e.alias&&e.alias.length>0?"-"+e.alias[0]:"--"+e.key,Et=e=>{const t=[];return e.alias&&e.alias.length>0&&t.push("-"+e.alias[0]),t.push("--"+e.key),t},et=()=>{const e=y(""),{showHint:t}=D(),s=r=>{if(!t)return;if(!r){e.value="";return}const n=Se.trim(r).split(" "),a=n[0].toLowerCase(),u=Object.keys(k).filter(g=>g.startsWith(a))[0],d=k[u];if(!d){e.value="";return}d.subCommands&&Object.keys(d.subCommands).length>0&&n.length>1?e.value=z(d.subCommands[n[1]],d):e.value=z(d)},o=Re.debounce(function(r){s(r)},500);return{hint:e,setHint:s,debounceSetHint:o}},tt=(e,t)=>{const s=y(e.length);return{showPrevCommand:()=>{s.value>=1&&(s.value--,t.value.text=e[s.value].text)},showNextCommand:()=>{s.value<e.length-1?(s.value++,t.value.text=e[s.value].text):t.value.text=""},commandHistoryPos:s,listCommandHistory:()=>e}},st=e=>{document.onkeydown=t=>{const s=t.key;if(s>="a"&&s<="z"&&!t.metaKey&&!t.shiftKey&&!t.ctrlKey){e.focusInput();return}const o=t.code;for(const r of ot)o===r.code&&r.action(t,e)}},ot=[{desc:"查看上一条命令",code:"ArrowUp",keyDesc:"↑",action(e,t){e.preventDefault(),t.showPrevCommand()}},{desc:"查看下一条命令",code:"ArrowDown",keyDesc:"↓",action(e,t){e.preventDefault(),t.showNextCommand()}}],N=e=>(ve("data-v-a83b9ce8"),e=e(),xe(),e),nt={class:"tp-terminal"},rt=N(()=>w("span",{style:{"user-select":"none"}}," [local]$ ",-1)),at={class:"terminal-row"},ct=N(()=>w("span",{style:{"user-select":"none"}}," [local]$ ",-1)),ut={key:1,class:"terminal-row"},it={class:"terminal-row"},lt=N(()=>w("span",{class:"command-input-prompt"},"🎊[local]$",-1)),dt={key:0,class:"terminal-row tip"},mt=q({__name:"index",props:{height:{default:"100%"},background:{default:"https://img.btstu.cn/api/images/5de7786cc7586.jpg"},onSubmitCommand:{}},setup(e,{expose:t}){const s=e,o=M(()=>{const{background:c}=s,l=c.startsWith("http")?`url(${c})`:c;return{height:s.height,background:l}}),r={text:"",placeholder:""},n=y([0]),a=y({...r}),u=y([]),d=y([]),g=y(),R=D();let S;const{hint:U,debounceSetHint:G}=et(),{showPrevCommand:Q,showNextCommand:X,commandHistoryPos:J,listCommandHistory:ee}=tt(d.value,a),te=async()=>{var f;const c=a.value.text,l={type:"command",text:c,resultList:[]};S=l,await((f=s.onSubmitCommand)==null?void 0:f.call(s,c)),u.value.push(l),c&&(d.value.push(l),J.value=d.value.length),console.log(u.value),n.value.push(u.value.length-1),a.value={...r}};we(()=>{G(a.value.text)});const O=(c,l)=>{const f={text:c,type:"text",status:l};S.resultList.push(f)},se=c=>{S.collapsible=c},oe=c=>{O(c,"error")},ne=c=>{O(c,"success")},re=(c,l)=>{const f={text:c,type:"text",status:l};u.value.push(f)},ae=c=>{S.resultList.push(c)},V=()=>{g.value.focus()};function ce(c){c.target.className==="tp-terminal"&&V()}const C={writeTextResult:O,setTerminalCollapsible:se,writeTextErrorResult:oe,writeTextSuccessResult:ne,writeTextOutput:re,writeResult:ae,focusInput:V,showPrevCommand:Q,showNextCommand:X,listCommandHistory:ee,clear:()=>{u.value=u.value.filter(c=>c.type!=="command")}};return ge(()=>{st(C);const{welcomeTexts:c}=R;(c==null?void 0:c.length)>0?c.forEach(l=>{C.writeTextOutput(l)}):(C.writeTextOutput(`欢迎来到 TP-Terminal，<a href="//github.com/2022-Interview/TP-Terminal" target='_blank'> GitHub Open Source</a>`),C.writeTextOutput("✨输入 'help' 查看所有命令"))}),t({terminal:C}),(c,l)=>{const f=qe,ue=ke,ie=Ce,le=Te;return i(),m("div",{class:"tp-terminal-wrapper",style:he(o.value),onClick:ce},[w("div",nt,[x(ie,{activeKey:n.value,"onUpdate:activeKey":l[0]||(l[0]=p=>n.value=p),bordered:!1,"expand-icon-position":"end"},{default:b(()=>[(i(!0),m(h,null,P(u.value,(p,K)=>(i(),m(h,{key:K},[p.collapsible?(i(),$(ue,{key:K,class:"terminal-row"},{header:b(()=>[rt,w("span",null,E(p.text),1)]),default:b(()=>[(i(!0),m(h,null,P(p.resultList,(I,L)=>(i(),m("div",{key:L},[x(f,{output:I},null,8,["output"])]))),128))]),_:2},1024)):(i(),m(h,{key:1},[p.type==="command"?(i(),m(h,{key:0},[w("div",at,[ct,w("span",null,E(p.text),1)]),(i(!0),m(h,null,P(p.resultList,(I,L)=>(i(),m("div",{key:L,class:"terminal-row"},[x(f,{output:I},null,8,["output"])]))),128))],64)):(i(),m("div",ut,[x(f,{output:p},null,8,["output"])]))],64))],64))),128))]),_:1},8,["activeKey"]),w("div",it,[x(le,{ref_key:"commandInputRef",ref:g,value:a.value.text,"onUpdate:value":l[1]||(l[1]=p=>a.value.text=p),class:"command-input",bordered:!1,placeholder:a.value.placeholder,onPressEnter:te,onfocus:"",autofocus:""},{addonBefore:b(()=>[lt]),_:1},8,["value","placeholder"])]),_(U)?(i(),m("div",dt,"hint："+E(_(U)),1)):T("",!0)])],4)}}});const pt=Oe(mt,[["__scopeId","data-v-a83b9ce8"]]),Z=async(e,t,s)=>{if(e=e.trim(),!e)return;const o=ft(e,s);if(!o){t.writeTextErrorResult("找不到命令");return}const r=_t(e,o.options),{_:n}=r;if(n.length>0&&o.subCommands&&Object.keys(o.subCommands).length>0){const a=e.substring(e.indexOf(" ")+1);await Z(a,t,o);return}await yt(o,r,t,s)},ft=(e,t)=>{const s=e.split(" ",1)[0];s.toLowerCase();let o=k;return t&&t.subCommands&&(o=t.subCommands),o[s]},_t=(e,t)=>{const s=e.split(" ").slice(1),o={alias:{},default:{},string:[],boolean:[]};return t.forEach(n=>{var R;const{alias:a,key:u,type:d,defaultValue:g}=n;a&&o.alias&&(o.alias[u]=a),(R=o[d])==null||R.push(u),g&&o.default&&(o.default[u]=g)}),Ie(s,o)},yt=async(e,t,s,o)=>{const{help:r}=t;if(e.collapsible&&s.setTerminalCollapsible(!0),r){const n={...t,_:[e.func]};W.action(n,s,o)}await e.action(t,s)},wt=q({__name:"index",setup(e){const t=y(),s=async o=>{if(!o)return;const r=t.value.terminal;await Z(o,r)};return(o,r)=>{const n=pt;return i(),$(n,{ref_key:"terminalRef",ref:t,"on-submit-command":s},null,512)}}}),$t=Object.freeze(Object.defineProperty({__proto__:null,default:wt},Symbol.toStringTag,{value:"Module"}));export{Et as a,Xe as c,z as g,$t as i,v as m};
